<!-- Host de toasts de PrimeNG -->
<p-toast key="global" position="top-center" styleClass="app-toast"></p-toast>

<div class="auth-shell">
  <p-card styleClass="auth-card auth-card-scroll">
    <ng-template pTemplate="header">
      <div class="auth-header">
        <div class="brand" aria-hidden="true">
          <img src="assets/logo-register.webp" alt="TimeLogic" />
        </div>
        <h1 class="title">Iniciar sesión</h1>
        <p class="subtitle">Accede con tu cuenta</p>
      </div>
    </ng-template>

    <form
      class="auth-form"
      [attr.aria-busy]="loading()"
      [class.is-loading]="loading()"
      [formGroup]="loginForm"
      (ngSubmit)="onSubmit()"
      novalidate
    >
      <!-- Email -->
      <div class="field">
        <span class="p-input-icon-left p-float-label with-separator">
          <i class="pi pi-envelope"></i>
          <input
            id="login-email"
            #emailEl
            pInputText
            type="email"
            formControlName="email"
            autocomplete="username"
            inputmode="email"
            autocapitalize="none"
            autocorrect="off"
            spellcheck="false"
            [attr.aria-invalid]="email.invalid || null"
            aria-describedby="login-email-err"
          />
          <label for="login-email">Correo electrónico</label>
        </span>
        <small
          id="login-email-err"
          class="p-error"
          *ngIf="email.invalid && (email.touched || email.dirty)"
        >
          {{
            email.hasError("required")
              ? "El correo es obligatorio."
              : "Correo no válido."
          }}
        </small>
      </div>

      <!-- Password -->
      <div class="field tight">
        <span class="p-input-icon-left p-float-label with-separator stretch">
          <i class="pi pi-lock"></i>
          <p-password
            inputId="login-pass"
            formControlName="password"
            [feedback]="false"
            [toggleMask]="true"
            appendTo="body"
            [style]="{ display: 'block', width: '100%' }"
          ></p-password>
          <label for="login-pass">Contraseña</label>
        </span>
        <small
          id="login-pass-err"
          class="p-error"
          *ngIf="password.invalid && (password.touched || password.dirty)"
        >
          La contraseña es obligatoria.
        </small>

        <p-message
          *ngIf="errorMessage"
          severity="error"
          [text]="errorMessage"
          class="message-global"
          [escape]="true"
        ></p-message>

        <span class="sr-only" aria-live="assertive" aria-atomic="true">
          {{ errorMessage }}
        </span>

      </div>

      <!-- Recordarme + Olvidé -->
      <div class="field remember-inline">
        <p-checkbox
          inputId="rememberMe"
          formControlName="rememberMe"
          [binary]="true"
          label="Recordarme"
        ></p-checkbox>

        <a
          class="forgot-inline"
          routerLink="/auth/forgot-password"
          aria-label="Recuperar contraseña"
        >
          ¿Olvidaste tu contraseña?
        </a>
      </div>

      <!-- Submit -->
      <button
        pButton
        type="submit"
        class="auth-submit"
        [loading]="loading()"
        [disabled]="loginForm.invalid || loading()"
        [label]="loading() ? 'Entrando…' : 'Entrar'"
      ></button>
    </form>

    <ng-template pTemplate="footer">
      <div class="auth-footer">
        ¿No tienes cuenta? <a routerLink="/auth/register">Regístrate</a>
      </div>
    </ng-template>
  </p-card>
</div>
